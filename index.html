<!--
	作者：yeshengqiang
	时间：2016-06-24
	描述：APP入口
-->
<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>智慧园区</title>
		<link href="css/mui.min.css" rel="stylesheet" />
	</head>

	<body>
		<script src="js/mui.min.js"></script>
		<script src="js/DBUtils.js"></script>
		<script type="text/javascript" charset="utf-8">
			mui.init();
			mui.plusReady(function() {
				// 仅支持竖屏显示
				plus.screen.lockOrientation("portrait-primary");
				var first = plus.storage.getItem("IsFrist");
				if (first) {
					//跳转到main页面
					mui.openWindow({
						url: "html/main/main.html",
						id: "main",
						waiting: {
							autoShow: false
						}
					});
				} else {
					//加载app动画
					mui.openWindow({
						url: "guide.html",
						id: "guide",
						waiting: {
							autoShow: false
						}
					});
				}
			});
			
	document.addEventListener( "plusready", function(){
    message = document.getElementById("message");
    // 监听点击消息事件
    plus.push.addEventListener( "click", function( msg ) {
        // 判断是从本地创建还是离线推送的消息
        switch( msg.payload ) {
            case "LocalMSG":
            	//alert("bendi:"+msg.payload);
            	var msgJs={
            			eventId:msg.eventId,
			    		title:msg.title,
			    		type:msg.messageType,
			    		content:msg.content,
			    		processAction:msg.processAction,
			    		messageNo:msg.messageNo,
			    		messageLevel:msg.messageLevel,
			    		status:0,
            	};
            	websql.insertPushMessage(msgJs,function(res){
            		alert(res.status);
            	});
                outSet( "点击本地创建消息启动：" );
            break;
            default:
            	var msgJs={
            			eventId:msg.eventId,
			    		title:msg.title,
			    		type:msg.,
			    		content:msg.content,
			    		processAction:msg.processAction,
			    		messageNo:msg.messageNo,
			    		messageLevel:msg.messageLevel,
			    		status:0,
            	};
            	websql.insertPushMessage(msgJs,function(res){
            		alert(res.status);
            	});
            	//alert("离线推送消息"+msg.payload);
                outSet( "点击离线推送消息启动：");
            break;
        }
        // 提示点击的内容
//      plus.ui.alert( msg.content );
        // 处理其它数据
        logoutPushMsg( msg );
    }, false );
    // 监听在线消息事件
    plus.push.addEventListener( "receive", function( msg ) {
        if ( msg.aps ) {  // Apple APNS message
            outSet( "接收到在线APNS消息：" );
        } else {
            outSet( "接收到在线透传消息：" );
            alert("feibeidi"+msg.payload);
        }
        logoutPushMsg( msg );
    }, false );
}, false );
		</script>
	</body>

</html>