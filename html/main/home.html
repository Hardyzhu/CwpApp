<!--
	作者：yeshengqiang
	时间：2016-06-24
	描述：首页主窗口
-->
<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>智慧园区</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="../../css/common.css"/>
		<link rel="stylesheet" href="../../css/home.css" />
		<link rel="stylesheet" href="../../css/new.css" />	
		<style>
			.isHide{
				display:none;
			}
			.isShow{
				display:block;
			}
		</style>
	</head>
	</head>
	<body>
		<!--轮播-->
		<div id="slider" class="mui-slider slider-pannel" >
			<div class="mui-slider-group">
				<!-- 额外增加的一个节点(循环轮播：第一个节点是最后一张轮播) -->
				<!--<div class="mui-slider-item mui-slider-item-duplicate">
					<div class="autoSilder">
					
					</div>
				</div>-->
				<!-- 第一张 -->
				<div class="mui-slider-item">
					<div class="chart" id="lineChart"></div>
				</div>
				<div class="mui-slider-item">
					<div class="chart" id="faultChart"></div>
				</div>
				<div class="mui-slider-item">
					<div class="chart" id="eleChart"></div>
				</div>
				<div class="mui-slider-item">
					<div class="chart" id="securityChart"></div>
				</div>
				
				<!-- 额外增加的一个节点(循环轮播：最后一个节点是第一张轮播) -->
				<!--<div class="mui-slider-item mui-slider-item-duplicate hidden">
					<div class="autoSilder">
						
					</div>
				</div>-->
			</div>
			<div class="mui-slider-indicator">
				<div class="mui-indicator mui-active"></div>
				<div class="mui-indicator"></div>
				<div class="mui-indicator"></div>
				<div class="mui-indicator"></div>
			</div>
		</div>
		<!--内容-->
		<div class="mui-col-xs-12 mui-text-center clearfix classify button-pannel" id="tablist">
			
		
		</div>
		<script type="text/html" id="btn">
			<div data-url="securityAlarm.html" class="mui-col-xs-3 fl subClassify tabList {{sec | toshow}}">
				<div class="mui-col-xs-12 fl">
					<div class="mui-col-xs-12 fl">
						 <img src="../../image/home-1.png" width="40" alt="安防告警" />
					</div>
					<div class="mui-col-xs-12 mui-text-center fl " style="margin-top: 5px; ">
						<span >安防告警</span>
					</div>
				</div>
			</div>	
			<div data-url="security.html" class="mui-col-xs-3 fl subClassify tabList {{alm | toshow}}">
				<div class="mui-col-xs-12 fl">
					<div class="mui-col-xs-12 fl">
						<img src="../../image/home-2.png" width="40" alt="故障告警" />
					</div>
					<div class="mui-col-xs-12 mui-text-center fl" style="margin-top: 5px; ">
						<span>故障告警</span>
					</div>
				</div>
			</div>
			<div data-url="JobIndex.html" class="mui-col-xs-3 fl subClassify tabList {{order | toshow}}">
				<div class="mui-col-xs-12 fl">
					<div class="mui-col-xs-12 fl">
						<img src="../../image/home-3.png" width="40" alt="工单审批" />
					</div>
					<div class="mui-col-xs-12 mui-text-center fl" style="margin-top: 5px; ">
						<span>工单审批</span>
					</div>
				</div>
			</div>
			<div data-url="energy.html" class="mui-col-xs-3 fl subClassify tabList">
				<div class="mui-col-xs-12 fl">
					<div class="mui-col-xs-12 fl">
						<img src="../../image/home-4.png" width="40" alt="空调" />
					</div>
					<div class="mui-col-xs-12 mui-text-center fl" style="margin-top: 5px; ">
						<span>能耗分析</span>
					</div>
				</div>
			</div>
			<div data-url="Equipment.html" class="mui-col-xs-3 fl subClassify tabList">
				<div class="mui-col-xs-12 fl">
					<div class="mui-col-xs-12 fl">
						<img src="../../image/icon-1.png" width="40" alt="空调" />
					</div>
					<div class="mui-col-xs-12 mui-text-center fl" style="margin-top: 5px; ">
						<span>设备监控</span>
					</div>
				</div>
			</div>
		</script>
		<script src="../../js/mui.min.js"></script>
		<script src="../../js/template.js"></script>
		<script src="../../js/echarts-all.js"></script>
		<script src="../../js/mui.conf.js"></script>
		<script type="text/javascript" charset="utf-8">
			mui.init({
				swipeBack:true //启用右滑关闭功能
			});
			mui.plusReady(function() {
				var self = plus.webview.currentWebview();
				var isLogin = plus.storage.getItem("userInfo");
				var userRole=JSON.parse(isLogin).role[0].roleId;
				
				gotoDetail(self);   //跳转
//				var slider = mui("#slider");
//				slider.slider({
//					interval: 8000
//				});
				//加入角色信息
				var state = {};
				state.sec = 0;
				state.alm = 0;
				state.order=0;
				template.helper('toshow',function(inp){
					if(inp==1){
						return 'isHide';
					}else{
						return '';
					}
				});
				if(JSON.parse(isLogin).role!=""||JSON.parse(isLogin).role!=0){
					for(var i = 0; i < JSON.parse(isLogin).role.length; i++){
						console.log(userRole);
						if(userRole=='14'||userRole=='4'){
							//不可看安防告警
							state.sec = '1';						
						}else if(userRole=='5'||userRole=='6'||userRole=='15'){
							//不可看故障告警
							state.alm = '1';
							//不可看工单
							state.order='1';
						}
						else if(userRole=='13'){
							//不可看故障告警
							state.sec = '1';
						}
					}
				}
				var btnHtml = template('btn',state);
				document.getElementById('tablist').innerHTML = btnHtml;
				plus.nativeUI.closeWaiting();
			});
			
			
			//跳转
			
			//质量报表
			
			var getOption = function(chartType) {
					var chartOption = chartType == 'pie' ? {
					calculable: false				
				} : {
					title : {
					    text: '功耗报表',
					    x:'center',
					    textStyle:{
					    	fontSize:14,
					    	fontWeight:'normal'
					    }
					},
					color:['#007aff'],//设置曲线颜色
					grid: {            //给图表定位
						x: 60,
						x2: 30,
						y: 35,
						y2: 30
					},
					tooltip : {    //	气泡提示框
						trigger: 'axis' //直角坐标系中的一个坐标轴，坐标轴可分为类目型、数值型或时间型
					},
					calculable : false,
					xAxis : [ //直角坐标系中的横轴，通常并默认为类目型
						{
							type : 'category',
							boundaryGap : false,
							data : ['一月','二月','三月','四月','五月','六月']//加载数据
						}
					],
					yAxis : [  //	直角坐标系中的纵轴，通常并默认为数值型
						{
							type : 'value',
							axisLabel : {//设置纵坐标的单位
								formatter: '{value} kwh'
							}
						}
					],
					series : [//数据系列，一个图表可能包含多个系列，每一个系列可能包含多个数据
						{
							name:'耗电量',//所表示的类型
							type:'line', //图标类型
							smooth:true,
							itemStyle: {normal: {areaStyle: {type: 'default'}}},//图表样式设置
							data:[31, 35, 24, 26, 50, 75]//加载数据
						}
					]
				};
				return chartOption;
			};
			
			
			var byId = function(id) {
				return document.getElementById(id);
			};
			var lineChart = echarts.init(byId('lineChart'));
			lineChart.setOption(getOption('line'));
			/*byId("echarts").addEventListener('tap',function(){
				var url = this.getAttribute('data-url');
				plus.runtime.openURL(url);
			},false);*/
			var eleOption = {
					color:["#e17131","#ffc000","#1111d5"],//设置曲线颜色
					title : {
				        text: '安防告警',
				        x:'center',
				        textStyle:{
					    	fontSize:14,
					    	fontWeight:'normal'
					    }
				    },
					tooltip : {
						trigger: 'item',
						formatter: "{a} <br/>{b} : {c} ({d}%)"
					},
					legend: {
						itemGap:5,
						y:'15%',
                    	data:['未处理(共213条)','处理中(共158条)','已处理(共101条)']
                	},
					calculable : false,
					 
					series : [
	                    {
	                        name:'安防告警',
	                        type:'pie',
	                        radius : '55%',
	                        center: ['50%', '65%'],
	                        itemStyle : {
				                normal : {
				                    labelLine : {
				                        show : false,
				                        length:-10
				                    }
				                   }
				            },
	                        data:[
	                            {value:213, name:'未处理(共213条)'},
	                            {value:158, name:'处理中(共158条)'},
	                            {value:101, name:'已处理(共101条)'}
	                        ]
	                    }
	                ]
				}
			var defaultOption = {
					title : {
					    text: '维修工单',
					    x:'center',
					    textStyle:{
					    	fontSize:14,
					    	fontWeight:'normal'
					    }
					},
					legend:{
						y:'13%',
						data:['设备数','故障数']
					},
					color:['#007aff',"#fa7d3c"],//设置曲线颜色
					grid: {            //给图表定位
						x: 60,
						x2: 30,
						y: 50,
						y2: 30
					},
					tooltip : {    //	气泡提示框
						trigger: 'axis' //直角坐标系中的一个坐标轴，坐标轴可分为类目型、数值型或时间型
					},
					calculable : false,
					xAxis : [ //直角坐标系中的横轴，通常并默认为类目型
						{
							type : 'category',
//							boundaryGap : false,
							data : ['空调','新风','排污泵','门禁']//加载数据
						}
					],
					yAxis : [  //	直角坐标系中的纵轴，通常并默认为数值型
						{
							type : 'value',
							axisLabel : {//设置纵坐标的单位
								formatter: '{value} 个'
							}
						}
					],
					series : [//数据系列，一个图表可能包含多个系列，每一个系列可能包含多个数据
						{
							name:'设备数',//所表示的类型
							type:'bar', //图标类型
							smooth:true,
//							itemStyle: {normal: {areaStyle: {type: 'default'}}},//图表样式设置
							data:[20, 30, 9, 25]//加载数据
						},
						{
							name:'故障数',//所表示的类型
							type:'bar', //图标类型
							smooth:true,
//							itemStyle: {normal: {areaStyle: {type: 'default'}}},//图表样式设置
							data:[2, 6, 7, 7]//加载数据
						}
					]
				};
			var securityOption = {
					color:["#e17131","#ffc000","#1111d5"],//设置曲线颜色
					title : {
					    text: '故障告警',
					    x:'center',
					    textStyle:{
					    	fontSize:14,
					    	fontWeight:'normal'
					    }
					},
					tooltip : {
						trigger: 'item',
						formatter: "{a} <br/>{b} : {c} ({d}%)"
					},
					legend: {
						itemGap:5,
						y:'15%',
                    	data:['未处理(共35条)','处理中(共23条)','已处理(共52条)']
                	},
					calculable : false,
					series : [
	                    {
	                        name:'故障告警',
	                        type:'pie',
	                        radius : '55%',
	                        center: ['50%', '65%'],
	                       	avoidLabelOverlap: false,
				            itemStyle : {
				                normal : {
				                    labelLine : {
				                        show : false,
				                        length:-10
				                    }
				                   }
				            },
	                        data:[
	                            {value:35, name:'未处理(共35条)'},
	                            {value:23, name:'处理中(共23条)'},
	                            {value:52, name:'已处理(共52条)'}
	                        ]
	                    }
	                ] 
				};
			
			var item2Show = false,item3Show = false,item4Show = false;//子选项卡是否显示标志
			document.querySelector('.mui-slider').addEventListener('slide',
			function(event) {
				if (event.detail.slideNumber === 1&&!item2Show) {
    				var faultLineChart = echarts.init(byId('faultChart'));
					faultLineChart.setOption(defaultOption);
				    //改变标志位，下次直接显示
				    item2Show = true;
				}else if (event.detail.slideNumber === 2&&!item3Show) {
				    var eleLineChart = echarts.init(byId('eleChart'));
					eleLineChart.setOption(eleOption);
				    //改变标志位，下次直接显示
				    item3Show = true;
				}else if(event.detail.slideNumber === 3&&!item4Show){
					var noneLineChart = echarts.init(byId('securityChart'));
					noneLineChart.setOption(securityOption);
				    item4Show = true;
				}});
			
			mui('.mui-slider').slider({interval:0});
			/**
			 * 点击事件
			 */
			function gotoDetail(self) {
				var homeUrl = "";
				mui('#tablist').on('tap','.tabList',function(){
					homeUrl = this.getAttribute("data-url");
					if(homeUrl=='energy.html'){
						mui.openWindow({
							url: "../energy/"+homeUrl,
							id: homeUrl,
							waiting: {
								autoShow: false
							}
						});
					}else if(homeUrl=='JobIndex.html'){
						mui.openWindow({
							url: "../workflow/"+homeUrl,
							id: homeUrl,
							waiting: {
								autoShow: false
							}
						});
					}else{
						mui.openWindow({
							url: "../home/"+homeUrl,
							id: homeUrl,
							waiting: {
								autoShow: false
							}
						});
					}
				});
				//var list = document.getElementsByClassName("tabList");
				/*
				for (var i = 0, len = list.length; i < len; i++) {
					list[i].addEventListener("tap", function() {
						
					});
				}*/
			}
		</script>
	</body>
</html>
