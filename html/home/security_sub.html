<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../../css/mui.min.css">
		<link rel="stylesheet" href="../../js/mask/mask.css">
		<link rel="stylesheet" type="text/css" href="../../css/common.css"/>
		<link rel="stylesheet" type="text/css" href="../../css/add.css"/>
		<link rel="stylesheet" type="text/css" href="../../css/new.css"/>
		<style>
			.barNav{
				list-style: none;
				background: #FFFFFF;
				padding:5px 0;
				margin-bottom:10px;
				border-top:1px solid #DEDEDE;
				border-bottom:1px solid #DEDEDE;
			}
			.barNav li{
				float:left;
				border-right:1px solid #DEDEDE;
				padding:4px 0;
				font-size:1.4rem;
				color:#9C9C9C;
				text-align:center;
			}
			.mui-icon{
				font-size:1.4rem;
			}
			.searchData{
				margin: 15px 15px 0;
			}
		</style>
	</head>
	<body>
		<div id="pullrefresh" class="mui-content mui-scroll-wrapper">
			<div class="mui-scroll">
				<!--搜索部分-->
				<div class="mui-content-padded searchData">
					<div class="mui-input-row mui-search">
						<input type="search" class="mui-input-clear" placeholder="请输入关键字" />
					</div>
				</div>
				<ul class="mui-col-xs-12 barNav clearfix">
					<li class="mui-col-xs-3">排序
						<span class="mui-icon mui-icon-arrowdown"></span>
					</li>
					<li class="mui-col-xs-3">未处理
						<span class="mui-icon mui-icon-arrowdown"></span>
					</li>
					<li class="mui-col-xs-3" style="border:none;">与我相关
						<span class="mui-icon mui-icon-arrowdown"></span>
					</li>
				</ul>
				<div class="mui-col-xs-12" id="list"></div>
				<script id="detailTmpl" type="text/html">
					{{each beans}}
						{{if $value.eventProcessStatus == 1}}
						    <div class="mui-col-xs-12 mb5 dataList list-pannel" style="background:#FFFAFA !important;">
						{{else if $value.eventProcessStatus == 2}}
							<div class="mui-col-xs-12 mb5 dataList list-pannel" style="background:#F3FBFE !important;">
						{{else}}
						    <div class="mui-col-xs-12 mb5 dataList list-pannel" style="background:#FFF !important;;">
						{{/if}}
							<h3 class="list-title">{{$value.deviceName}}
								<span class="emergency mui-pull-right">
									{{if $value.warningLevel == 0}}
									    <span class="scile scileLow"></span>
										<span class="sileSize sileLow">低</span>
									{{else if $value.warningLevel == 2}}
									    <span class="scile scileMiddle"></span>
										<span class="scile scileMiddle"></span>
										<span class="sileSize sileMiddle">中</span>
									{{else}}
									    <span class="scile scileHeight"></span>
										<span class="scile scileHeight"></span>
										<span class="scile scileHeight"></span>
										<span class="sileSize sileHeight">高</span>
									{{/if}}
								</span>
							</h3>
							<div class="mui-col-xs-12 muiDetail list-body">
								{{$value.eventDescribe}}
							</div>
							<div class="mui-col-xs-12 muiDetail">				
							    {{if $value.eventProcessStatus == 1}}
								    <span class="btnState redColor font1rem">未恢复</span>
								{{else if $value.eventProcessStatus == 2}}
								    <span class="btnState blueColor font1rem">处理中</span>
								{{else}}
								    <span class="btnState greenColor font1rem">已恢复</span>
								{{/if}}
								<span class="Timecolor">{{$value.applyTime}}</span>
								<a data-id="{{$value.warningEventId}}" data-uid="{{$value.warningCategoryId}}" class="mui-pull-right goToDel list-link-a" href="javascript:void(0);">
									查看详情
									<span class="mui-icon mui-icon-arrowright"></span>
								</a>
							</div>
						</div>
				    {{/each}}		
				</script>
			</div>
		</div>
		<script src="../../js/mui.min.js"></script>
		<script src="../../js/template.js"></script>
		<script src="../../js/mask/mask.js"></script>
		<script src="../../js/mui.conf.js"></script>
		<script type="text/javascript" charset="utf-8">
			mui.init({
				pullRefresh: {
					container: '#pullrefresh',
					up: {
						auto:true,
					    contentrefresh : "正在加载...",
						callback: pullupRefresh
					}
				}
			});
			mui.plusReady(function() {
				var self = plus.webview.currentWebview();
				var isLogin = plus.storage.getItem("userInfo");
				/**
				 * 跳转到详情页面
				 */
				
				var detailPage = null;
				if(!detailPage){
					detailPage = mui.preload({
					     url:"../task/securityDetail.html",
					     id:"securityDetail"
					});
				}
				mui('.mui-content').on('tap', '.goToDel', function(e) {
					var warningEventId = this.getAttribute("data-id");
					var warningCategoryId = this.getAttribute("data-uid");

					//自定义事件
					mui.fire(detailPage,'detailId',{
					    warningEventId:warningEventId,
					    warningCategoryId:warningCategoryId
					});
					//打开页面
					mui.openWindow({
					  id:'securityDetail',
					  waiting: {
						autoShow: false
					  }
					});
				});
			});
			var mark = false;
			var page = 1;
			//渲染数据
			function getProductList() { //获取工单列表
				mui.ajax({
					url: global_url+"/cwp/front/sh/warningEvent!execute",				
					type: "post",
					async: true,
					data: {
						uid: 'c016',
						currentPage:page,
						pageSize:'5',
						dictValue:'', 
						eventProcessStatus:'',
						eventType:3
					},
					dataType: "json",
					timeout: 10000,
					success: function(data) {
						var oList = document.getElementById("list");
						var html = template('detailTmpl', data);
						oList.innerHTML += html;
						if(data.beans.length<5){
							mark = true;
							mui('#pullrefresh').pullRefresh().disablePullupToRefresh();
							mui.toast('没有更多数据了!');
							qmask.hide();
							return;
						}
						qmask.hide();
					},
					error: function(xhr, type, errorThrown) {
						if(type=='timeout'){
							mui.toast('请求超时:请检查网络!');
						}else {
							mui.toast('数据加载失败!');
						}
						qmask.hide();
						return;
					}
				});
			}
			/**
			 * 上拉加载具体业务实现
			 */
			function pullupRefresh() {
				qmask.show();
				setTimeout(function() {
					mui('#pullrefresh').pullRefresh().endPullupToRefresh(mark); //参数为true代表没有更多数据了。
					page++;
					getProductList();
				}, 1500);
			}
			if (mui.os.plus) {
				mui.plusReady(function() {
					setTimeout(function() {
						mui('#pullrefresh').pullRefresh().pullupLoading();
					}, 1000);
				});
			} else {
				mui.ready(function() {
					mui('#pullrefresh').pullRefresh().pullupLoading();
				});
			}
		</script>
	</body>
</html>
